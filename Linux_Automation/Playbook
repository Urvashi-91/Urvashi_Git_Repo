---
- hosts: webservers
  remote_user: root

  tasks:
  - name: ensure apache is at the latest version
    yum: name=httpd state=latest
  - name: write the apache config file
    template: src=/srv/httpd.j2 dest=/etc/httpd.conf


- hosts: databases
  remote_user: root

  tasks:
  - name: ensure postgresql is at the latest version
    yum: name=postgresql state=latest
  - name: write the postgresql is started
    service: name=postgresql state=started


- hosts: applications
  remote_user: root

  tasks:
    - name: copy a file
      copy:
        src: testfile
        dest: /home/use/testregister
        mode: 400
      register: var
    - name: output debug info
      debug: msg="debug info is {{var}}"
    yum: name=postgresql state=latest
  - name: write the postgresql is started
    service: name=postgresql state=started